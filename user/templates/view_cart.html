<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart | Time2Order</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#fdf2f8',
                            100: '#fce7f3',
                            200: '#fbcfe8',
                            300: '#f9a8d4',
                            400: '#f472b6',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d',
                            800: '#9d174d',
                            900: '#831843',
                        },
                        accent: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.6s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                        'bounce-gentle': 'bounceGentle 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideDown: {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' }
                        },
                        bounceGentle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' }
                        }
                    },
                    backdropBlur: {
                        xs: '2px',
                    }
                }
            }
        }
    </script>
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .cart-item-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .cart-item-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 15s ease-in-out infinite;
        }
        
        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .shape:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            right: 15%;
            animation-delay: 2s;
        }
        
        .shape:nth-child(3) {
            width: 60px;
            height: 60px;
            top: 80%;
            left: 30%;
            animation-delay: 4s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(20px) rotate(240deg); }
        }
        
        .quantity-btn {
            transition: all 0.2s ease;
        }
        
        .quantity-btn:hover {
            transform: scale(1.1);
        }
        
        .quantity-btn:active {
            transform: scale(0.95);
        }
        
        .sticky-summary {
            position: sticky;
            top: 1rem;
        }
        
        .cart-badge {
            animation: pulse 2s infinite;
        }
        
        .remove-btn-hover {
            transition: all 0.3s ease;
        }
        
        .remove-btn-hover:hover {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transform: scale(1.05);
        }
        
        .checkout-btn-hover {
            transition: all 0.3s ease;
        }
        
        .checkout-btn-hover:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(5, 150, 105, 0.4);
        }
        .modal-backdrop {
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.6);
        }
        
        .modal-content-animation {
            animation: modalSlideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .loading-spinner {
            border: 4px solid rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .price-highlight {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .savings-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        
        
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <!-- Floating Background Shapes -->
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <!-- Header -->
    <header class="glass-effect sticky top-0 z-50 border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
<!-- Back Button -->
<a href="{{ url_for('home') }}" 
   class="flex items-center space-x-2 px-4 py-2 
          bg-gradient-to-r from-teal-500 to-indigo-600 
          hover:from-teal-600 hover:to-indigo-700 
          rounded-xl transition-all duration-300 hover:scale-105 
          text-white font-semibold shadow-lg">
    <i class="fas fa-arrow-left text-white"></i>
    <span class="hidden sm:inline">Back to Shopping</span>
</a>

<!-- Title -->
<h1 class="text-xl md:text-2xl font-poppins font-bold flex items-center gap-2">
    <i class="fas fa-shopping-cart text-amber-300 mr-2 cart-badge"></i>
    <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-400 via-pink-500 to-purple-500">
        Your Cart
    </span>
</h1>


<!-- Cart Count -->
<div class="flex items-center space-x-2 px-4 py-2 
            bg-blue-100 rounded-xl shadow-md">
    <i class="fas fa-box text-indigo-600"></i>
    <span class="text-indigo-800 font-semibold" id="cartItemCount">
        {{ products|length if products else 0 }} items
    </span>
</div>

            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-8">
        {% if products %}
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Cart Items Section -->
                <div class="lg:col-span-2 space-y-4">
                    <!-- Cart Header -->
                    <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-4 md:p-6 border border-white/50 shadow-lg">
                        <div class="flex items-center justify-between">
                            <h2 class="text-xl md:text-2xl font-poppins font-bold text-gray-900">
                                Cart Items
                            </h2>

                        </div>
                    </div>

                    <!-- Cart Items -->
                    <div class="space-y-4" id="cartItemsContainer">
                        {% for product in products %}
                        <div class="cart-item bg-white/80 backdrop-blur-sm rounded-2xl border border-white/50 shadow-lg cart-item-hover animate-slide-up" 
                             data-product-id="{{ product.product_id }}" 
                             data-product-measure="{{ product.product_measure }}"
                             style="animation-delay: {{ loop.index0 * 0.1 }}s">
                            
                            <div class="p-4 md:p-6">
                                <div class="flex flex-col sm:flex-row gap-4">
                                    <!-- Product Image -->
                                    <div class="flex-shrink-0">
                                        <div class="relative">
                                            <img src="{{ product.product_image }}" 
                                                 alt="{{ product.product_name }}" 
                                                 class="w-full sm:w-24 md:w-32 h-24 md:h-32 object-cover rounded-xl border-2 border-gray-100">
                                            <div class="absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                                <i class="fas fa-check text-white text-xs"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Product Details -->
                                    <div class="flex-1 min-w-0">
                                        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
                                            <div class="flex-1">
                                                <h3 class="text-lg md:text-xl font-poppins font-semibold text-gray-900 mb-2 line-clamp-2">
                                                    {{ product.product_name }}
                                                </h3>
                                                
                                                <!-- Product Meta -->
                                                <div class="flex flex-wrap items-center gap-3 mb-3">
                                                    <span class="inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
                                                        <i class="fas fa-weight mr-1"></i>
                                                        {{ product.product_measure }}
                                                    </span>
                                                </div>

                                                <!-- Price Section -->
                                                <div class="flex items-center gap-3 mb-4">
                                                    <span class="text-2xl md:text-3xl font-bold price-highlight">
                                                        ₹{{ product.product_price }}
                                                    </span>
                                                    <span class="text-lg text-gray-500 line-through">
                                                        ₹{{ (product.product_price + (product.product_price // 5))|int }}
                                                    </span>
                                                </div>

                                                <!-- Quantity Controls -->
                                                <div class="flex items-center space-x-2">
                                                    <button type="button" title="Decrease quantity" onclick="updateQuantity('{{ product.product_id }}', -1)" 
                                                        class="quantity-btn w-8 h-8 bg-white rounded-lg flex items-center justify-center text-gray-600 hover:text-red-500 hover:bg-red-50">
                                                        <i class="fas fa-minus text-sm"></i>
                                                    </button>
                                                    <span class="quantity-value px-4 py-2 font-semibold text-gray-900 min-w-[3rem] text-center">{{ product.quantity }}</span>
                                                    <button type="button" title="Increase quantity" onclick="updateQuantity('{{ product.product_id }}', 1)" 
                                                        class="quantity-btn w-8 h-8 bg-white rounded-lg flex items-center justify-center text-gray-600 hover:text-green-500 hover:bg-green-50">
                                                        <i class="fas fa-plus text-sm"></i>
                                                    </button>
                                                </div>
                                                    
                                                <div class="text-sm text-gray-600">
                                                    <span class="font-medium">Subtotal: </span>
                                                    <span class="subtotal font-bold text-gray-900">₹{{ product.subtotal }}</span>
                                                </div>
                                            </div>

                                            <div class="flex flex-col gap-2">

                                                
                                                <form action="{{ url_for('remove_from_cart') }}" method="post" class="flex-1 sm:flex-none">
                                                    <input type="hidden" name="product_id" value="{{ product.product_id }}">
                                                    <input type="hidden" name="product_measure" value="{{ product.product_measure }}">
                                                    <button type="submit" 
                                                            onclick="return confirm('Remove this item from cart?')"
                                                            class="w-full px-4 py-2 bg-red-100 hover:bg-red-500 text-red-600 hover:text-white rounded-xl font-medium remove-btn-hover text-sm">
                                                        <i class="fas fa-trash mr-1"></i>
                                                        <span class="hidden sm:inline">Remove</span>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Continue Shopping -->
                    <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-4 md:p-6 border border-white/50 shadow-lg">
                        <a href="{{ url_for('home') }}" 
                           class="flex items-center justify-center space-x-2 text-blue-600 hover:text-blue-700 font-medium transition-colors">
                            <i class="fas fa-arrow-left"></i>
                            <span>Continue Shopping</span>
                        </a>
                    </div>
                </div>

                <!-- Order Summary Section -->
                <div class="lg:col-span-1">
                    <div class="sticky-summary">
                        <!-- Price Details -->
                        <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-4 md:p-6 border border-white/50 shadow-lg mb-6 animate-slide-up" style="animation-delay: 0.3s">
                            <h3 class="text-xl font-poppins font-bold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-receipt mr-2 text-blue-600"></i>
                                Price Details
                            </h3>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span>Original Price</span>
                                    <span class="font-semibold">₹{{ (total + (total // 5))|int }}</span>
                                </div>
                                <div class="flex justify-between items-center text-green-600">
                                    <span>Discount</span>
                                    <span class="font-semibold">-₹{{ (total // 5)|int }}</span>
                                </div>
                                <hr class="border-gray-200">
                                <div class="flex justify-between items-center text-lg font-bold">
                                    <span>Total Amount</span>
                                    <span class="cart-total text-green-600">₹{{ total|int }}</span>
                                </div>
                                <div class="text-green-600 text-sm font-medium">
                                    You will save ₹{{ (total // 5)|int }} on this order
                                </div>
                            </div>
                        </div>

                        <!-- Checkout Form -->
                        <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-4 md:p-6 border border-white/50 shadow-lg animate-slide-up" style="animation-delay: 0.4s">
                            <h3 class="text-xl font-poppins font-bold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-calendar-check mr-2 text-purple-600"></i>
                                Pickup Details
                            </h3>
                            
                            <form id="checkout-form" action="{{ url_for('place_order') }}" method="post" class="space-y-4">
                                <!-- Pickup Time -->
                                <div>
                                    <label for="picking_time_display" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-clock mr-1 text-blue-500"></i>
                                        Select Pickup Time
                                    </label>
                                    <input type="text" 
                                           name="picking_time_display" 
                                           id="picking_time_display" 
                                           placeholder="Choose date and time" 
                                           class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300"
                                           required>
                                    <input type="datetime-local" name="picking_time" id="picking_time" class="hidden" required>
                                </div>

                                <!-- Remarks -->
                                <div>
                                    <label for="remarks" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-comment mr-1 text-green-500"></i>
                                        Special Instructions (Optional)
                                    </label>
                                    <textarea name="remarks" 
                                              id="remarks" 
                                              rows="3" 
                                              placeholder="Any special requests or instructions..."
                                              class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 resize-none"></textarea>
                                </div>

                                <!-- Warning Message -->
                                <div class="text-red-600 text-sm font-medium bg-red-50 p-3 rounded-xl">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    Once the order is placed, it cannot be cancelled for any reason.
                                </div>

                                <!-- Checkout Button -->
                                <button type="submit" 
                                        class="w-full py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-bold text-lg checkout-btn-hover flex items-center justify-center space-x-2">
                                    <i class="fas fa-shopping-bag"></i>
                                    <span>Place Order</span>
                                    <i class="fas fa-arrow-right"></i>
                                </button>

                                <!-- Security Badge -->
                                <div class="flex items-center justify-center space-x-2 text-gray-500 text-sm">
                                    <i class="fas fa-shield-alt text-green-500"></i>
                                    <span>100% Secure Checkout</span>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        {% else %}
            <!-- Empty Cart -->
            <div class="max-w-md mx-auto text-center py-16 animate-slide-up">
                <div class="bg-white/80 backdrop-blur-sm rounded-3xl p-8 md:p-12 border border-white/50 shadow-lg">
                    <div class="w-24 h-24 bg-gradient-to-r from-blue-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-shopping-cart text-blue-500 text-4xl"></i>
                    </div>
                    <h2 class="text-2xl md:text-3xl font-poppins font-bold text-gray-900 mb-4">Your Cart is Empty</h2>
                    <p class="text-gray-600 mb-8 text-lg">Looks like you haven't added any items to your cart yet. Start shopping to fill it up!</p>
                    <a href="{{ url_for('home') }}" 
                       class="inline-flex items-center space-x-2 px spoj -8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-bold text-lg hover:scale-105 transition-all duration-300 shadow-lg">
                        <i class="fas fa-store"></i>
                        <span>Start Shopping</span>
                    </a>
                </div>
            </div>
        {% endif %}
    </main>

    <!-- Order Success Modal -->
    <div id="order-modal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl modal-content-animation">
                <div class="text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i id="modal-icon" class="fas fa-check text-green-500 text-2xl"></i>
                    </div>
                    <h2 id="modal-title" class="text-2xl font-poppins font-bold text-gray-900 mb-2">Order Placed!</h2>
                    <p id="modal-message" class="text-gray-600 mb-6"></p>
                    <div class="space-y-4">
                        <button type="button" id="view-orders-btn" 
                                class="w-full py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-semibold hover:scale-105 transition-all duration-300">
                            View Orders
                        </button>
                        <button type="button" id="close-order-modal" 
                                class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Preview Modal -->
    <div id="preview-modal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-white rounded-3xl p-6 md:p-8 max-w-lg w-full shadow-2xl modal-content-animation max-h-[90vh] overflow-y-auto">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-eye text-blue-500 text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-poppins font-bold text-gray-900">Order Preview</h2>
                </div>
                
                <div id="preview-content" class="bg-gray-50 rounded-2xl p-4 mb-6 max-h-64 overflow-y-auto">
                    <!-- Preview content will be inserted here -->
                </div>
                <div class="space-y-4">
                    <div class="text-red-600 text-sm font-medium bg-red-50 p-3 rounded-xl">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Once the order is placed, it cannot be cancelled for any reason.
                    </div>
                    <button type="button" id="confirm-order" 
                            class="w-full py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:scale-105 transition-all duration-300">
                        <i class="fas fa-check mr-2"></i>
                        Confirm Order
                    </button>
                    <button type="button" id="cancel-order" 
                            class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-3xl p-8 text-center shadow-2xl">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-700 font-semibold">Placing your order...</p>
                <p class="text-gray-500 text-sm mt-2">Please wait while we process your request</p>
            </div>
        </div>
    </div>
<!-- Footer -->
<footer style="background: var(--bg-dark); color: var(--text-white); padding: 3rem 2rem 2rem; margin-top: 4rem;">
  <div style="max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: wrap; justify-content: space-between; gap: 2rem;">
    <div style="flex: 1; min-width: 250px;">
      <h3 style="font-family: 'Poppins', sans-serif; font-size: 1.5rem; font-weight: 700; color: #4facfe;">Time2Order</h3>
      <p style="margin-top: 1rem; line-height: 1.7; color: var(--text-light);">
        Your smart gateway to local shopping. Pre-order essentials and support your nearby vendors.
      </p>
    </div>

    <div style="flex: 1; min-width: 200px;">
      <h4 style="font-weight: 600; margin-bottom: 1rem;">Quick Links</h4>
      <ul style="list-style: none; padding: 0; line-height: 2;">
        <li><a href="/about" style="color: #cbd5e0; text-decoration: none;">About Us</a></li>
        <li><a href="/terms" style="color: #cbd5e0; text-decoration: none;">Terms & Conditions</a></li>
        <li><a href="/privacy" style="color: #cbd5e0; text-decoration: none;">Privacy Policy</a></li>
        <li><a href="/contact" style="color: #cbd5e0; text-decoration: none;">Contact</a></li>
      </ul>
    </div>

    <div style="flex: 1; min-width: 200px;">
      <h4 style="font-weight: 600; margin-bottom: 1rem;">Connect With Us</h4>
      <div style="display: flex; gap: 1rem; font-size: 1.25rem;">
        <a href="#" style="color: #38bdf8;"><i class="fab fa-facebook-f"></i></a>
        <a href="#" style="color: #60a5fa;"><i class="fab fa-twitter"></i></a>
        <a href="#" style="color: #f87171;"><i class="fab fa-instagram"></i></a>
        <a href="#" style="color: #34d399;"><i class="fab fa-whatsapp"></i></a>
      </div>
    </div>
  </div>

  <hr style="margin: 2rem 0; border-color: rgba(255,255,255,0.1);" />

  <p style="text-align: center; color: #a0aec0; font-size: 0.9rem;">
    &copy; {{ current_year or 2025 }} Time2Order. All rights reserved.
  </p>
</footer>

    <script>
        $(document).ready(function() {
            // Initialize date picker
            const now = new Date();
            const isoDate = new Date(now.getTime() + (5.5 * 60 * 60 * 1000)).toISOString().slice(0, 16);
            $('#picking_time').attr('min', isoDate);
            
            flatpickr('#picking_time_display', {
                enableTime: true,
                dateFormat: 'Y-m-d h:i K',
                time_24hr: false,
                minDate: new Date(),
                onChange: function(selectedDates, dateStr, instance) {
                    if (selectedDates.length > 0) {
                        const selectedDate = selectedDates[0];
                        const year = selectedDate.getFullYear();
                        const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                        const day = String(selectedDate.getDate()).padStart(2, '0');
                        let hours = selectedDate.getHours();
                        const minutes = String(selectedDate.getMinutes()).padStart(2, '0');
                        const isoDate = `${year}-${month}-${day}T${String(hours).padStart(2, '0')}:${minutes}`;
                        $('#picking_time').val(isoDate);
                        const formattedDisplay = dateStr.replace(/\b0(\d):/, '$1:');
                        instance.input.value = formattedDisplay;
                    }
                }
            });

            // Form submission
            $('#checkout-form').on('submit', function(event) {
                event.preventDefault();
                showPreview();
            });

            // Modal event handlers
            $('#confirm-order').on('click', confirmOrder);
            $('#cancel-order').on('click', () => $('#preview-modal').addClass('hidden'));
            $('#close-order-modal').on('click', () => $('#order-modal').addClass('hidden'));
            $('#view-orders-btn').on('click', function() {
                window.location.href = '/orders';
            });
        });

        // Utility functions
        function showLoading() {
            $('#loading-overlay').removeClass('hidden');
        }

        function hideLoading() {
            $('#loading-overlay').addClass('hidden');
        }

        function showPreview() {
            const total = $('.cart-total').text().replace('₹', '');
            const pickingTime = $('#picking_time_display').val();
            const remarks = $('#remarks').val();
            
            let previewContent = `
                <div class="space-y-4">
                    <div class="flex justify-between items-center p-3 bg-white rounded-xl">
                        <span class="font-medium text-gray-700">Total Amount:</span>
                        <span class="font-bold text-xl text-green-600">₹${total}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white rounded-xl">
                        <span class="font-medium text-gray-700">Pickup Time:</span>
                        <span class="font-semibold text-blue-600">${pickingTime}</span>
                    </div>
            `;
            
            if (remarks) {
                previewContent += `
                    <div class="p-3 bg-white rounded-xl">
                        <span class="font-medium text-gray-700">Special Instructions:</span>
                        <p class="text-gray-600 mt-1">${remarks}</p>
                    </div>
                `;
            }
            
            previewContent += '<div class="bg-white rounded-xl p-3"><h4 class="font-semibold text-gray-900 mb-2">Items:</h4>';
            
            $('.cart-item').each(function() {
                const name = $(this).find('h3').text();
                const quantity = $(this).find('.quantity-value').text();
                const subtotal = $(this).find('.subtotal').text();
                previewContent += `
                    <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                        <div>
                            <span class="font-medium text-gray-800">${name}</span>
                            <span class="text-gray-500 text-sm ml-2">Qty: ${quantity}</span>
                        </div>
                        <span class="font-semibold text-gray-900">${subtotal}</span>
                    </div>
                `;
            });
            
            previewContent += '</div></div>';
            
            $('#preview-content').html(previewContent);
            $('#preview-modal').removeClass('hidden');
        }

        async function confirmOrder() {
            $('#preview-modal').addClass('hidden');
            showLoading();
            
            const form = $('#checkout-form')[0];
            const formData = new FormData(form);
            
            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: new URLSearchParams(formData)
                });
                
                const data = await response.json();
                hideLoading();
                
                const modal = $('#order-modal');
                const modalTitle = $('#modal-title');
                const modalMessage = $('#modal-message');
                const modalIcon = $('#modal-icon');
                const viewOrdersBtn = $('#view-orders-btn');
                
                if (data.success) {
                    modalIcon.removeClass().addClass('fas fa-check text-green-500 text-2xl');
                    modalTitle.text('Order Placed Successfully!');
                    modalMessage.text(data.message);
                    viewOrdersBtn.removeClass('hidden');
                    
                    // Clear cart UI
                    $('#cartItemsContainer').empty();
                    $('#cartItemCount').text('0 items');
                    $('.cart-total').text('₹0');
                } else {
                    modalIcon.removeClass().addClass('fas fa-exclamation-triangle text-red-500 text-2xl');
                    modalTitle.text('Order Failed');
                    modalMessage.text(data.message);
                    viewOrdersBtn.addClass('hidden');
                }
                
                modal.removeClass('hidden');
                
            } catch (error) {
                hideLoading();
                const modal = $('#order-modal');
                const modalTitle = $('#modal-title');
                const modalMessage = $('#modal-message');
                const modalIcon = $('#modal-icon');
                
                modalIcon.removeClass().addClass('fas fa-exclamation-triangle text-red-500 text-2xl');
                modalTitle.text('Error');
                modalMessage.text('An error occurred while placing the order.');
                $('#view-orders-btn').addClass('hidden');
                modal.removeClass('hidden');
                
                console.error('Error:', error);
            }
        }

        async function updateQuantity(productId, change) {
            if (!productId || isNaN(change)) {
                alert('Invalid product ID or quantity change.');
                return;
            }
            
            const cartItem = $(`.cart-item[data-product-id="${productId}"]`);
            if (!cartItem.length) {
                alert('Cart item not found.');
                return;
            }
            
            const productMeasure = cartItem.data('product-measure') || 'N/A';
            
            try {
                const response = await fetch('/update-cart-quantity', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        product_id: productId,
                        product_measure: productMeasure,
                        change: change
                    }).toString()
                });
                
                const data = await response.json();
                
                if (data.success) {
                    if (data.remove) {
                        cartItem.addClass('animate-fade-out');
                        setTimeout(() => {
                            cartItem.remove();
                            if (!$('.cart-item').length) {
                                window.location.reload();
                            }
                        }, 300);
                    } else {
                        cartItem.find('.quantity-value').text(data.quantity);
                        cartItem.find('.subtotal').text(`₹${data.subtotal.toFixed(2)}`);
                        const totalElement = $('.cart-total');
                        if (totalElement.length) {
                            totalElement.text(`₹${data.total.toFixed(2)}`);
                        }
                    }
                    
                    // Update cart count
                    const currentCount = parseInt($('#cartItemCount').text().split(' ')[0]);
                    const newCount = data.remove ? currentCount - 1 : currentCount;
                    $('#cartItemCount').text(`${newCount} items`);
                    
                } else {
                    alert(data.message || 'Failed to update quantity.');
                }
            } catch (error) {
                alert('An error occurred while updating the quantity.');
                console.error('Error:', error);
            }
        }



        // Add CSS for fade out animation
        const style = document.createElement('style');
        style.textContent = `
            .animate-fade-out {
                animation: fadeOut 0.3s ease-out forwards;
            }
            
            @keyframes fadeOut {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(-20px);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>